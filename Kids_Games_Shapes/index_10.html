
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Color & Shape Explorer Game (Enriched)</title>
  <style>
    body {
      margin:0; min-height:100vh; font-family:'Comic Sans MS', Arial, sans-serif;
      text-align:center; overflow-x:hidden;
      background:linear-gradient(to bottom, #aeefff 0%, #fffbe0 80%);
      transition:background 1s;
    }
    h1 { color:#2e86c1; font-size:2.1em; margin-top:18px;}
    #prompt, #quizPrompt {font-size:1.4em; color:#166869; margin:18px 0 5px;}
    #visual-cue {display:inline-block; vertical-align:middle;}
    .shape {
      display:inline-block; margin:25px 20px; cursor:pointer;
      transition:transform 0.2s; outline:none;text-align:center;vertical-align:top;
    }
    .shape svg {width:120px; height:120px;}
    .shape:active {transform:scale(1.12);}
    .label {
      margin-top:5px; font-size:1.08em;
      color:#446368; background:#fffbe0; border-radius:8px;
      padding:1px 10px; display:inline;
    }
    #feedback {font-size:1.15em; font-weight:bold; color:#219831; margin-top:10px; min-height:28px;}
    #fact-block {margin-top:13px; font-size:1.02em; color:#684c16; min-height:24px;}
    #sticker-board {margin-top:13px; font-size:1.3em; min-height:34px;}
    #milestone-popup {display:none;position:fixed;top:33%;left:50%;transform:translate(-50%,-50%);
      font-size:2em; background:#fffbe0ee; color:#216869; border-radius:24px;
      padding:34px 45px 24px 45px; z-index:99; border:3px solid #fffde9; box-shadow:0 12px 24px #9999cc44; animation:popscale 0.7s cubic-bezier(.5,1.7,.13,.83);}
    @keyframes popscale{0%{transform:translate(-50%,-50%) scale(0.5);}80%{transform:translate(-50%,-50%) scale(1.09);}100%{transform:translate(-50%,-50%) scale(1);}
    }
    #bg-artwork{position:absolute;left:0;right:0;top:0;pointer-events:none;z-index:-1;}
    #album {margin:13px auto; width:90%;max-width:420px; background:#f5fbe4; border-radius:16px; border:2px solid #bdd6c1;box-shadow:0 1px 12px #8882; padding:8px;}
    #album h2{font-size:1em;color:#2b663b;margin:0 0 7px 0;}
    .album-pic{display:inline-block;margin:4px;text-align:center;}
    .album-pic svg{width:44px;height:44px;}
    .album-label{font-size:.94em;color:#43825c;}
    #langpicker{margin:10px 0; font-size:.97em;}
    .btnLang{font-size:.95em; padding:4px 10px; margin:0 7px;
      border: 1.5px solid #aeefff; border-radius:10px; background:#fafffb;}
    .btnLang.selected{background:#e0ffd4; border-color:#88d776; color:#097;}
    .quizstar{font-size:1.1em; color:#e8910a;}
    #progress-bar-bg { width:65%; background: #dcf8ff; height:18px; border-radius:12px; margin:10px auto;}
    #progress-bar { background:#58e490; height:100%; border-radius:12px; width:0%; transition:width 0.6s; }
    #mission-block {font-size:1.09em;margin:12px 0;}
    #trophy-cabinet {margin:10px auto;color:#bd7c2f;}
    #real-life-example {margin-top:12px;}
    /* Reset Button */
    #reset-btn {
      position:fixed;top:16px;right:18px;z-index:100;
      font-size:1.06em;padding:6px 18px;
      background:#ffe066;border:2px solid #ffde66;
      border-radius:13px;cursor:pointer;color:#aa8707;
      box-shadow:0 2px 8px #ccc8;
    }
  </style>
</head>
<body>
  <button id="reset-btn">üîÑ New Game</button>
  <svg id="bg-artwork" width="100%" height="180">
    <circle id="sun-bg" cx="90" cy="90" r="50" fill="#ffe066"/>
    <ellipse cx="280" cy="60" rx="48" ry="20" fill="#e7f5ff"/>
    <ellipse cx="340" cy="85" rx="28" ry="12" fill="#bedfff"/>
    <ellipse cx="670" cy="90" rx="48" ry="16" fill="#f7f8ff"/>
    <ellipse cx="710" cy="70" rx="22" ry="10" fill="#e5f4ff"/>
    <ellipse cx="900" cy="60" rx="38" ry="18" fill="#e7f5ff"/>
  </svg>
  <div id="milestone-popup"></div>
  <h1>Color & Shape Explorer!</h1>
  <div id="langpicker"></div>
  <div id="progress-bar-bg"><div id="progress-bar"></div></div>
  <div id="mission-block"></div>
  <div id="prompt"></div>
  <span id="visual-cue"></span>
  <div id="quizPrompt"></div>
  <div id="shape-row"></div>
  <div id="feedback"></div>
  <div id="fact-block"></div>
  <div id="real-life-example"></div>
  <div id="sticker-board"></div>
  <div id="album"><h2>My Shapes:</h2><div id="album-pics"></div></div>
  <div id="trophy-cabinet"></div>
  <audio id="ding" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp"></audio>
  <audio id="oops" src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/3/wrong-answer.mp"></audio>
  <audio id="cheer" src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/3/clapping.mp"></audio>
  <audio id="high-quality-audio-player" src="" preload="auto"></audio>
  
  <div id="endBoard" style="
	  display:none;
	  position:fixed;
	  top:0;left:0;width:100vw;height:100vh;
	  background:linear-gradient(to bottom,#aeefff 0,#fffbe0 80%);
	  text-align:center;z-index:9999;
	  font-family:'Comic Sans MS',Arial,sans-serif;">
	  <h1 style="margin-top:48px;font-size:3em;color:#2e86c1;">üéâ The End üéâ</h1>
	  <div id="endSummary" style="font-size:1.3em; margin:32px 0;"></div>
	  <button onclick="playAgain()" style="padding:1em 2em;font-size:1.1em;border-radius:12px;background:#3399ff;color:white;border:none;box-shadow:2px 3px 11px #aeefff;">Play Again</button>
	</div>
  
  
<script>
/* ... shapeData, quizQuestions, stickers, niceWords etc., same as your original code ... */





let unlockedShapeGroup = 0; // how many groups of shapes are unlocked
// Add this directly under: let unlockedShapeGroup = 0;
let missionsAfterFinalUnlock = 0; // how many missions completed AFTER reaching the final shape group


const shapeGroups = [
  // Level 0 (unlocked at start): Super-easy
  [
    {
      id: "circle",
      name: {en:"Circle", nl:"Cirkel"},
      color: {en:"red", nl:"rode"},
      svg: `<svg width="120" height="120"><circle cx="60" cy="60" r="50" fill="#ff5050" stroke="#fff" stroke-width="4"/><ellipse cx="48" cy="50" rx="9" ry="13" fill="#fff"/><ellipse cx="72" cy="50" rx="9" ry="13" fill="#fff"/><ellipse cx="48" cy="54" rx="3" ry="6" fill="#3b1e13"/><ellipse cx="72" cy="54" rx="3" ry="6" fill="#3b1e13"/><ellipse cx="60" cy="80" rx="14" ry="7" fill="#fff"/><ellipse cx="60" cy="85" rx="10" ry="3.5" fill="#fde3ea"/><path d="M50 84 Q60 94 70 84" stroke="#de3d00" stroke-width="2" fill="none"/></svg>`,
      fact: {en:"A circle is round and has no corners or edges.", nl:"Een cirkel is rond en heeft geen hoeken of randen."},
      mini: `<svg width="44" height="44"><circle cx="22" cy="22" r="16" fill="#ff5050" stroke="#eee" stroke-width="3"/></svg>`
    },
    {
      id: "triangle",
      name: {en:"Triangle", nl:"Driehoek"},
      color: {en:"blue", nl:"blauwe"},
      svg: `<svg width="120" height="120"><polygon points="60,15 110,105 10,105" fill="#3399ff" stroke="#fff" stroke-width="4"/><ellipse cx="47" cy="70" rx="9" ry="13" fill="#fff"/><ellipse cx="73" cy="70" rx="9" ry="13" fill="#fff"/><ellipse cx="47" cy="75" rx="3" ry="6" fill="#263354"/><ellipse cx="73" cy="75" rx="3" ry="6" fill="#263354"/><ellipse cx="60" cy="93" rx="14" ry="6" fill="#fff"/><ellipse cx="60" cy="96" rx="11" ry="3" fill="#e3f0fa"/><path d="M55 90 Q60 103 65 90" stroke="#025a9d" stroke-width="2" fill="none"/></svg>`,
      fact: {en:"A triangle has three sides and three corners.", nl:"Een driehoek heeft drie zijden en drie hoeken."},
      mini: `<svg width="44" height="44"><polygon points="22,5 39,39 5,39" fill="#3399ff" stroke="#eee" stroke-width="2"/></svg>`
    },
    {
      id: "square",
      name: {en:"Square", nl:"Vierkant"},
      color: {en:"green", nl:"groen"},
      svg: `<svg width="120" height="120"><rect x="15" y="15" width="90" height="90" rx="20" fill="#61e661" stroke="#fff" stroke-width="4"/><ellipse cx="43" cy="50" rx="9" ry="13" fill="#fff"/><ellipse cx="77" cy="50" rx="9" ry="13" fill="#fff"/><ellipse cx="43" cy="54" rx="3" ry="6" fill="#18512b"/><ellipse cx="77" cy="54" rx="3" ry="6" fill="#18512b"/><ellipse cx="60" cy="80" rx="14" ry="7" fill="#fff"/><ellipse cx="60" cy="83" rx="10" ry="3.5" fill="#e1ffd6"/><path d="M50 81 Q60 96 70 81" stroke="#177c3a" stroke-width="2" fill="none"/></svg>`,
      fact: {en:"A square has four equal sides and four corners.", nl:"Een vierkant heeft vier gelijke zijden en vier hoeken."},
      mini: `<svg width="44" height="44"><rect x="8" y="8" width="28" height="28" rx="6" fill="#61e661" stroke="#eee" stroke-width="2"/></svg>`
    },
    {
      id: "rectangle",
      name: {en:"Rectangle", nl:"Rechthoek"},
      color: {en:"orange", nl:"oranje"},
      svg: `<svg width="120" height="120"><rect x="18" y="36" width="84" height="48" rx="13" fill="#ffb347" stroke="#fff" stroke-width="4"/></svg>`,
      fact: {en:"A rectangle has four sides‚Äîtwo are long, two are short!", nl:"Een rechthoek heeft vier zijden‚Äîtwee lang, twee kort!"},
      mini: `<svg width="44" height="44"><rect x="5" y="13" width="34" height="18" rx="5" fill="#ffb347" stroke="#eee" stroke-width="2"/></svg>`
    }
  ],
  // Level 1 (unlocked after 1 mission)
  [
    {
      id: "star",
      name: {en:"Star", nl:"Ster"},
      color: {en:"yellow", nl:"gele"},
      svg: `<svg width="120" height="120"><polygon points="60,10 71,48 111,48 78,74 89,112 60,90 31,112 42,74 9,48 49,48" fill="#ffe066" stroke="#fff" stroke-width="3"/></svg>`,
      fact: {en:"A star has five points.", nl:"Een ster heeft vijf punten."},
      mini: `<svg width="44" height="44"><polygon points="22,4 26,17 39,17 28,27 32,40 22,33 12,40 16,27 5,17 18,17" fill="#ffe066" stroke="#eee" stroke-width="1.5"/></svg>`
    },
    {
      id: "oval",
      name: {en:"Oval", nl:"Ovaal"},
      color: {en:"purple", nl:"paars"},
      svg: `<svg width="120" height="120"><ellipse cx="60" cy="60" rx="44" ry="28" fill="#b784ff" stroke="#fff" stroke-width="4"/></svg>`,
      fact: {en:"An oval is shaped like an egg!", nl:"Een ovaal is gevormd als een ei!"},
      mini: `<svg width="44" height="44"><ellipse cx="22" cy="22" rx="17" ry="10" fill="#b784ff" stroke="#eee" stroke-width="2"/></svg>`
    },
    {
      id: "diamond",
      name: {en:"Diamond", nl:"Ruit"},
      color: {en:"cyan", nl:"cyaan"},
      svg: `<svg width="120" height="120"><polygon points="60,12 108,60 60,108 12,60" fill="#44f3f9" stroke="#fff" stroke-width="4"/></svg>`,
      fact: {en:"A diamond looks like a kite or a gemstone.", nl:"Een ruit lijkt op een vlieger of een edelsteen."},
      mini: `<svg width="44" height="44"><polygon points="22,4 40,22 22,40 4,22" fill="#44f3f9" stroke="#eee" stroke-width="2"/></svg>`
    },
    {
      id: "heart",
      name: {en:"Heart", nl:"Hart"},
      color: {en:"crimson", nl:"karmozijnrood"},
      svg: `<svg width="120" height="120"><path d="M60 98 Q35 78 35 58 Q35 38 60 50 Q85 38 85 58 Q85 78 60 98 Z" fill="#e74c3c" stroke="#fff" stroke-width="4"/></svg>`,
      fact: {en:"A heart is a symbol of love and caring.", nl:"Een hart is een symbool voor liefde en zorg."},
      mini: `<svg width="44" height="44"><path d="M22 39 Q11 31 11 21 Q11 11 22 16 Q33 11 33 21 Q33 31 22 39 Z" fill="#e74c3c" stroke="#eee" stroke-width="1.5"/></svg>`
    }
  ],
  // Level 2 (unlocked after 2 missions): Polygons & honeycomb
  [
    {
      id: "pentagon",
      name: {en:"Pentagon", nl:"Vijfhoek"},
      color: {en:"teal", nl:"blauwgroen"},
      svg: `<svg width="120" height="120"><polygon points="60,16 109,50 91,104 29,104 11,50" fill="#41d6c3" stroke="#fff" stroke-width="4"/></svg>`,
      fact: {en:"A pentagon has five sides and five corners.", nl:"Een vijfhoek heeft vijf zijden en vijf hoeken."},
      mini: `<svg width="44" height="44"><polygon points="22,6 39,18 33,38 11,38 5,18" fill="#41d6c3" stroke="#eee" stroke-width="2"/></svg>`
    },
    {
      id: "hexagon",
      name: {en:"Hexagon", nl:"Zeshoek"},
      color: {en:"brown", nl:"bruin"},
      svg: `<svg width="120" height="120"><polygon points="60,16 104,38 104,82 60,104 16,82 16,38" fill="#a87b54" stroke="#fff" stroke-width="4"/></svg>`,
      fact: {en:"A hexagon has six sides‚Äîlike a honeycomb cell!", nl:"Een zeshoek heeft zes zijden‚Äîzoals een bijencel!"},
      mini: `<svg width="44" height="44"><polygon points="22,6 37,15 37,29 22,38 7,29 7,15" fill="#a87b54" stroke="#eee" stroke-width="2"/></svg>`
    },
    {
      id: "octagon",
      name: {en:"Octagon", nl:"Achtkant"},
      color: {en:"pink", nl:"roze"},
      svg: `<svg width="120" height="120"><polygon points="38,16 82,16 104,38 104,82 82,104 38,104 16,82 16,38" fill="#ff82a9" stroke="#fff" stroke-width="4"/></svg>`,
      fact: {en:"An octagon has eight sides‚Äîlike a stop sign!", nl:"Een achtkant heeft acht zijden‚Äîzoals een stopbord!"},
      mini: `<svg width="44" height="44"><polygon points="13,7 31,7 39,13 39,31 31,39 13,39 7,31 7,13" fill="#ff82a9" stroke="#eee" stroke-width="2"/></svg>`
    },
    {
      id: "parallelogram",
      name: {en:"Parallelogram", nl:"Parallellogram"},
      color: {en:"lime", nl:"limoen"},
      svg: `<svg width="120" height="120"><polygon points="25,95 95,95 75,25 5,25" fill="#b7ff45" stroke="#fff" stroke-width="4"/></svg>`,
      fact: {en:"A parallelogram has opposite sides equal and slanted.", nl:"Een parallellogram heeft twee paar gelijke, schuine zijden."},
      mini: `<svg width="44" height="44"><polygon points="7,38 37,38 29,7 0,7" fill="#b7ff45" stroke="#eee" stroke-width="1.5"/></svg>`
    }
  ],
  // Level 3 (unlocked after 3 missions): Fun and creative shapes!
  [
    {
      id: "crescent",
      name: {en:"Crescent", nl:"Halve maan"},
      color: {en:"light yellow", nl:"lichtgeel"},
      svg: `<svg width="120" height="120"><path d="M90 60 A30 30 0 1 1 75 27 A22 22 0 1 0 90 60 Z" fill="#fffec6" stroke="#fff" stroke-width="3"/></svg>`,
      fact: {en:"A crescent is a moon shape.", nl:"Een halve maan is een maansikkel."},
      mini: `<svg width="44" height="44"><path d="M33 22 A12 12 0 1 1 28 11 A9 9 0 1 0 33 22 Z" fill="#fffec6" stroke="#eee" stroke-width="1.5"/></svg>`
    },
    {
      id: "arrow",
      name: {en:"Arrow", nl:"Pijl"},
      color: {en:"light green", nl:"lichtgroen"},
      svg: `<svg width="120" height="120"><polygon points="60,15 85,70 70,70 70,105 50,105 50,70 35,70" fill="#7fffa4" stroke="#fff" stroke-width="4"/></svg>`,
      fact: {en:"An arrow points the way forward.", nl:"Een pijl wijst de richting aan."},
      mini: `<svg width="44" height="44"><polygon points="22,5 32,27 27,27 27,39 17,39 17,27 12,27" fill="#7fffa4" stroke="#eee" stroke-width="1.5"/></svg>`
    },
    {
      id: "fractal",
      name: {en:"Fractal", nl:"Fractaal"},
      color: {en:"multicolor", nl:"veelkleurig"},
      svg: `<svg width="120" height="120">
        <g>
          <circle cx="60" cy="60" r="27" fill="#8ac6ff"/>
          <circle cx="37" cy="37" r="10" fill="#ffb347"/>
          <circle cx="83" cy="37" r="10" fill="#ffb347"/>
          <circle cx="37" cy="83" r="10" fill="#b784ff"/>
          <circle cx="83" cy="83" r="10" fill="#b784ff"/>
          <circle cx="23" cy="23" r="4" fill="#41d6c3"/>
          <circle cx="97" cy="23" r="4" fill="#41d6c3"/>
          <circle cx="23" cy="97" r="4" fill="#44f3f9"/>
          <circle cx="97" cy="97" r="4" fill="#44f3f9"/>
          <circle cx="60" cy="10" r="7" fill="#ff82a9"/>
          <circle cx="60" cy="110" r="7" fill="#e74c3c"/>
        </g>
      </svg>`,
      fact: {en:"A fractal repeats its shape at different sizes, like beautiful snowflakes!", nl:"Een fractaal herhaalt zijn vorm op verschillende schalen‚Äîzoals een mooie sneeuwvlok!"},
      mini: `<svg width="44" height="44">
        <g>
          <circle cx="22" cy="22" r="11" fill="#8ac6ff"/>
          <circle cx="9" cy="9" r="4" fill="#ffb347"/>
          <circle cx="35" cy="9" r="4" fill="#ffb347"/>
          <circle cx="9" cy="35" r="4" fill="#b784ff"/>
          <circle cx="35" cy="35" r="4" fill="#b784ff"/>
        </g>
      </svg>`
    }
  ],
  // Level 4 (super-fun and creative shapes)
	[
	  {
		id: "smiley",
		name: {en:"Smiley", nl:"Lachgezicht"},
		color: {en:"bright yellow", nl:"geel"},
		svg: `<svg width="120" height="120"><circle cx="60" cy="60" r="53" fill="#fff837" stroke="#f1c40f" stroke-width="4"/><ellipse cx="45" cy="60" rx="9" ry="14" fill="#2d2d2d"/><ellipse cx="75" cy="60" rx="9" ry="14" fill="#2d2d2d"/><ellipse cx="60" cy="90" rx="24" ry="12" fill="#fff"/><ellipse cx="60" cy="97" rx="17" ry="6.5" fill="#fde3ea"/><path d="M45 88 Q60 108 75 88" stroke="#e17009" stroke-width="4" fill="none"/></svg>`,
		fact: {en:"A smiley face means happiness!", nl:"Een lachgezicht betekent vrolijkheid!"},
		mini: `<svg width="44" height="44"><circle cx="22" cy="22" r="20" fill="#fff837" stroke="#f1c40f" stroke-width="2"/><ellipse cx="16" cy="22" rx="4" ry="7" fill="#2d2d2d"/><ellipse cx="28" cy="22" rx="4" ry="7" fill="#2d2d2d"/><path d="M16 34 Q22 40 28 34" stroke="#e17009" stroke-width="2" fill="none"/></svg>`
	  },
	  {
		id: "sillystar",
		name: {en:"Silly Star", nl:"Grappige ster"},
		color: {en:"bright gold", nl:"goudkleurig"},
		svg: `<svg width="120" height="120"><polygon points="60,11 71,49 111,49 78,75 89,113 60,91 31,113 42,75 9,49 49,49" fill="#ffe755" stroke="#fff" stroke-width="4"/><ellipse cx="50" cy="57" rx="6" ry="7" fill="#2d2d2d"/><ellipse cx="72" cy="57" rx="6" ry="7" fill="#2d2d2d"/><ellipse cx="50" cy="59" rx="2" ry="4" fill="#fff"/><ellipse cx="72" cy="59" rx="2" ry="4" fill="#fff"/><path d="M50 80 Q60 95 70 80" stroke="#e17009" stroke-width="3" fill="none"/></svg>`,
		fact: {en:"A silly star is always shining and smiling!", nl:"Een grappige ster straalt en lacht altijd!"},
		mini: `<svg width="44" height="44"><polygon points="22,4 26,17 39,17 28,27 32,40 22,33 12,40 16,27 5,17 18,17" fill="#ffe755" stroke="#eee" stroke-width="1.5"/><ellipse cx="18" cy="18" rx="2" ry="2.5" fill="#2d2d2d"/><ellipse cx="26" cy="18" rx="2" ry="2.5" fill="#2d2d2d"/><path d="M18 26 Q22 29 26 26" stroke="#e17009" stroke-width="1.4" fill="none"/></svg>`
	  },
	  {
		id: "cloud",
		name: {en:"Cloud", nl:"Wolk"},
		color: {en:"white", nl:"wit"},
		svg: `<svg width="120" height="120"><ellipse cx="60" cy="80" rx="32" ry="20" fill="#f8fafd"/><ellipse cx="80" cy="70" rx="20" ry="15" fill="#f8fafd"/><ellipse cx="48" cy="69" rx="18" ry="14" fill="#d2e6ec"/><ellipse cx="60" cy="94" rx="24" ry="7" fill="#f8fafd"/><ellipse cx="59" cy="81" rx="5" ry="5" fill="#b6e3f6" opacity="0.5"/></svg>`,
		fact: {en:"A cloud floats in the sky!", nl:"Een wolk zweeft in de lucht!"},
		mini: `<svg width="44" height="44"><ellipse cx="22" cy="28" rx="13" ry="7" fill="#f8fafd"/><ellipse cx="30" cy="23" rx="7" ry="5" fill="#f8fafd"/><ellipse cx="16" cy="22" rx="5" ry="4" fill="#d2e6ec"/></svg>`
	  },
	  {
		id: "lightning",
		name: {en:"Lightning Bolt", nl:"Bliksemschicht"},
		color: {en:"yellow", nl:"geel"},
		svg: `<svg width="120" height="120"><polygon points="48,10 94,48 70,46 110,74 80,73 100,108 32,58 53,64 22,35" fill="#ffd324" stroke="#daa520" stroke-width="4"/></svg>`,
		fact: {en:"A lightning bolt is very fast!", nl:"Een bliksemschicht is supersnel!"},
		mini: `<svg width="44" height="44"><polygon points="15,6 35,19 26,18 37,29 27,28 34,40 13,23 20,26 8,15" fill="#ffd324" stroke="#daa520" stroke-width="1.3"/></svg>`
	  },
	  {
		id: "elsa",
		name: {en: "Elsa", nl: "Elsa"},
		color: {en: "blue", nl: "blauw"},
		svg: `<img src="elsa_1.png" alt="Elsa" style="width:120px; height:180px; object-fit:contain; border-radius:20px;" />`,
		fact: {en: "Elsa is the Snow Queen who loves ice and snow!", nl: "Elsa is de Sneeuwkoningin die houdt van ijs en sneeuw!"},
		mini: `<img src="elsa_1.png" alt="Elsa" style="width:44px; height:66px; object-fit:contain; border-radius:8px;" />`
	  }],
	  	// Level 5: 3D Shapes (new unlockable level)
[
  {
    id: "sphere",
    name: {en: "Sphere", nl: "Bol"},
    color: {en: "orange", nl: "oranje"},
    svg: `<svg width="120" height="120" viewBox="0 0 512 512"><g><circle style="fill:#FFA858;" cx="256" cy="256" r="245.801"/><path style="fill:#FFA858;" d="M11.219,256c0-37.177,109.592-67.315,244.781-67.315S500.781,218.823,500.781,256"/><path style="fill:#FFA858;" d="M500.781,256c0,37.177-109.592,67.315-244.781,67.315S11.219,293.177,11.219,256"/></g><g><path style="fill:#00537B;" d="M437.019,74.98C388.667,26.628,324.381,0,256,0C187.62,0,123.333,26.628,74.98,74.98S0,187.62,0,256 s26.628,132.667,74.98,181.02S187.62,512,256,512c68.381,0,132.667-26.628,181.019-74.98C485.372,388.667,512,324.38,512,256 S485.372,123.333,437.019,74.98z M256,20.398c121.116,0,221.162,91.867,234.156,209.576c-1.273,0.438-2.479,1.134-3.538,2.097 c-4.167,3.789-4.474,10.24-0.684,14.407c3.084,3.391,4.648,6.595,4.648,9.521c0,9.277-16.813,24.733-64.199,37.765 C381.004,306.243,320.496,313.116,256,313.116s-125.005-6.872-170.382-19.351c-47.387-13.032-64.2-28.487-64.2-37.765 c0-2.926,1.564-6.13,4.648-9.522c3.789-4.167,3.483-10.618-0.685-14.407c-1.059-0.963-2.265-1.658-3.537-2.096 C34.838,112.266,134.884,20.398,256,20.398z M256,491.602c-118.638,0-217.058-88.149-233.25-202.388 c13.289,9.212,32.54,17.366,57.459,24.219c47.089,12.95,109.519,20.081,175.79,20.081s128.702-7.131,175.79-20.081 c24.92-6.853,44.17-15.008,57.458-24.219C473.058,403.453,374.638,491.602,256,491.602z"/><path style="fill:#00537B;" d="M274.804,199.082c12.638,0.267,25.261,0.81,37.519,1.615c0.228,0.015,0.453,0.022,0.678,0.022 c5.328,0,9.814-4.139,10.168-9.532c0.368-5.621-3.889-10.476-9.509-10.845c-12.558-0.824-25.487-1.381-38.426-1.654 c-0.073-0.002-0.147-0.002-0.219-0.002c-5.533,0-10.076,4.425-10.193,9.984C264.703,194.302,269.172,198.963,274.804,199.082z"/><path style="fill:#00537B;" d="M349.673,204.056c12.835,1.485,25.284,3.291,37.004,5.369c0.602,0.106,1.2,0.158,1.792,0.158 c4.853,0,9.155-3.476,10.031-8.42c0.983-5.546-2.716-10.84-8.263-11.823c-12.121-2.148-24.98-4.014-38.219-5.546 c-5.594-0.65-10.655,3.364-11.304,8.959C340.066,198.348,344.076,203.409,349.673,204.056z"/><path style="fill:#00537B;" d="M422.985,217.32c13.175,3.482,24.834,7.362,34.652,11.532c1.3,0.553,2.653,0.814,3.982,0.814 c3.97,0,7.743-2.332,9.392-6.214c2.202-5.184-0.216-11.172-5.401-13.374c-10.712-4.55-23.3-8.748-37.413-12.478 c-5.442-1.44-11.028,1.808-12.467,7.255C414.292,210.298,417.54,215.88,422.985,217.32z"/><path style="fill:#00537B;" d="M50.419,229.65c1.329,0,2.68-0.261,3.981-0.813c9.82-4.168,21.48-8.046,34.653-11.526 c5.446-1.439,8.695-7.02,7.256-12.466c-1.439-5.445-7.018-8.695-12.466-7.256c-14.112,3.728-26.698,7.924-37.413,12.472 c-5.185,2.201-7.605,8.188-5.404,13.373C42.674,227.318,46.448,229.65,50.419,229.65z"/><path style="fill:#00537B;" d="M199.032,200.716c0.224,0,0.45-0.007,0.677-0.022c12.258-0.804,24.882-1.346,37.519-1.614 c5.632-0.118,10.1-4.78,9.982-10.412c-0.118-5.632-4.795-10.137-10.411-9.981c-12.939,0.273-25.865,0.829-38.423,1.652 c-5.621,0.368-9.879,5.224-9.51,10.845C189.218,196.578,193.702,200.716,199.032,200.716z"/><path style="fill:#00537B;" d="M123.566,209.577c0.591,0,1.19-0.051,1.792-0.158c11.715-2.077,24.164-3.882,37.002-5.367 c5.595-0.647,9.607-5.707,8.96-11.304c-0.647-5.595-5.705-9.615-11.304-8.96c-13.243,1.531-26.101,3.396-38.218,5.544 c-5.546,0.983-9.246,6.277-8.263,11.823C114.412,206.101,118.714,209.577,123.566,209.577z"/></g></svg>`,
    fact: {
      en: "A sphere is perfectly round like a ball.",
      nl: "Een bol is helemaal rond zoals een bal."
    },
    mini: `<svg width="44" height="44" viewBox="0 0 512 512"><g><circle style="fill:#FFA858;" cx="256" cy="256" r="245.801"/><path style="fill:#FFA858;" d="M11.219,256c0-37.177,109.592-67.315,244.781-67.315S500.781,218.823,500.781,256"/><path style="fill:#FFA858;" d="M500.781,256c0,37.177-109.592,67.315-244.781,67.315S11.219,293.177,11.219,256"/></g><g><path style="fill:#00537B;" d="M437.019,74.98C388.667,26.628,324.381,0,256,0C187.62,0,123.333,26.628,74.98,74.98S0,187.62,0,256 s26.628,132.667,74.98,181.02S187.62,512,256,512c68.381,0,132.667-26.628,181.019-74.98C485.372,388.667,512,324.38,512,256 S485.372,123.333,437.019,74.98z M256,20.398c121.116,0,221.162,91.867,234.156,209.576c-1.273,0.438-2.479,1.134-3.538,2.097 c-4.167,3.789-4.474,10.24-0.684,14.407c3.084,3.391,4.648,6.595,4.648,9.521c0,9.277-16.813,24.733-64.199,37.765 C381.004,306.243,320.496,313.116,256,313.116s-125.005-6.872-170.382-19.351c-47.387-13.032-64.2-28.487-64.2-37.765 c0-2.926,1.564-6.13,4.648-9.522c3.789-4.167,3.483-10.618-0.685-14.407c-1.059-0.963-2.265-1.658-3.537-2.096 C34.838,112.266,134.884,20.398,256,20.398z M256,491.602c-118.638,0-217.058-88.149-233.25-202.388 c13.289,9.212,32.54,17.366,57.459,24.219c47.089,12.95,109.519,20.081,175.79,20.081s128.702-7.131,175.79-20.081 c24.92-6.853,44.17-15.008,57.458-24.219C473.058,403.453,374.638,491.602,256,491.602z"/><path style="fill:#00537B;" d="M274.804,199.082c12.638,0.267,25.261,0.81,37.519,1.615c0.228,0.015,0.453,0.022,0.678,0.022 c5.328,0,9.814-4.139,10.168-9.532c0.368-5.621-3.889-10.476-9.509-10.845c-12.558-0.824-25.487-1.381-38.426-1.654 c-0.073-0.002-0.147-0.002-0.219-0.002c-5.533,0-10.076,4.425-10.193,9.984C264.703,194.302,269.172,198.963,274.804,199.082z"/><path style="fill:#00537B;" d="M349.673,204.056c12.835,1.485,25.284,3.291,37.004,5.369c0.602,0.106,1.2,0.158,1.792,0.158 c4.853,0,9.155-3.476,10.031-8.42c0.983-5.546-2.716-10.84-8.263-11.823c-12.121-2.148-24.98-4.014-38.219-5.546 c-5.594-0.65-10.655,3.364-11.304,8.959C340.066,198.348,344.076,203.409,349.673,204.056z"/><path style="fill:#00537B;" d="M422.985,217.32c13.175,3.482,24.834,7.362,34.652,11.532c1.3,0.553,2.653,0.814,3.982,0.814 c3.97,0,7.743-2.332,9.392-6.214c2.202-5.184-0.216-11.172-5.401-13.374c-10.712-4.55-23.3-8.748-37.413-12.478 c-5.442-1.44-11.028,1.808-12.467,7.255C414.292,210.298,417.54,215.88,422.985,217.32z"/><path style="fill:#00537B;" d="M50.419,229.65c1.329,0,2.68-0.261,3.981-0.813c9.82-4.168,21.48-8.046,34.653-11.526 c5.446-1.439,8.695-7.02,7.256-12.466c-1.439-5.445-7.018-8.695-12.466-7.256c-14.112,3.728-26.698,7.924-37.413,12.472 c-5.185,2.201-7.605,8.188-5.404,13.373C42.674,227.318,46.448,229.65,50.419,229.65z"/><path style="fill:#00537B;" d="M199.032,200.716c0.224,0,0.45-0.007,0.677-0.022c12.258-0.804,24.882-1.346,37.519-1.614 c5.632-0.118,10.1-4.78,9.982-10.412c-0.118-5.632-4.795-10.137-10.411-9.981c-12.939,0.273-25.865,0.829-38.423,1.652 c-5.621,0.368-9.879,5.224-9.51,10.845C189.218,196.578,193.702,200.716,199.032,200.716z"/><path style="fill:#00537B;" d="M123.566,209.577c0.591,0,1.19-0.051,1.792-0.158c11.715-2.077,24.164-3.882,37.002-5.367 c5.595-0.647,9.607-5.707,8.96-11.304c-0.647-5.595-5.705-9.615-11.304-8.96c-13.243,1.531-26.101,3.396-38.218,5.544 c-5.546,0.983-9.246,6.277-8.263,11.823C114.412,206.101,118.714,209.577,123.566,209.577z"/></g></svg>`
  },
  {
    id: "cube",
    name: {en: "Cube", nl: "Kubus"},
    color: {en: "Seafoam Green", nl: "Zeegroen"},
    svg: `<svg width="120" height="120" viewBox="0 0 58 58"><g><polygon style="fill:#26B99A;" points="29,58 3,45 3,13 29,26"/><polygon style="fill:#556080;" points="29,58 55,45 55,13 29,26"/><polygon style="fill:#434C6D;" points="3,13 28,0 55,13 29,26"/></g></svg>`,
    fact: {
      en: "A cube has 6 square faces all the same size.",
      nl: "Een kubus heeft 6 even grote vierkante vlakken."
    },
    mini: `<svg width="44" height="44" viewBox="0 0 58 58"><g><polygon style="fill:#26B99A;" points="29,58 3,45 3,13 29,26"/><polygon style="fill:#556080;" points="29,58 55,45 55,13 29,26"/><polygon style="fill:#434C6D;" points="3,13 28,0 55,13 29,26"/></g></svg>`
  },
  {
    id: "pyramid",
    name: {en: "Pyramid", nl: "Piramide"},
    color: {en: "yellow", nl: "geel"},
    svg: `<svg width="120" height="120" viewBox="0 0 465 465"><g><path style="fill:#FF9926;" d="M240,337.496c0,4.143-3.358,7.5-7.5,7.5v15c4.142,0,7.5,3.357,7.5,7.5v56.414l206.23-129.862 L240,48.113V337.496z M383,285.057c4.411,0,8,3.589,8,8s-3.589,8-8,8s-8-3.589-8-8S378.589,285.057,383,285.057z M353,255.057 c4.411,0,8,3.589,8,8s-3.589,8-8,8s-8-3.589-8-8S348.589,255.057,353,255.057z"/><path style="fill:#FECC33;" d="M225,337.496V48.112L18.77,294.048L225,423.91v-56.414c0-4.143,3.358-7.5,7.5-7.5v-15 C228.358,344.996,225,341.639,225,337.496z"/><path d="M463.247,290.995l-225-268.318c-0.073-0.088-0.154-0.165-0.231-0.249c-0.054-0.058-0.106-0.117-0.161-0.173 c-0.239-0.245-0.489-0.473-0.752-0.678c-0.024-0.018-0.049-0.034-0.073-0.052c-0.262-0.199-0.535-0.375-0.816-0.536 c-0.049-0.028-0.096-0.057-0.146-0.084c-0.308-0.167-0.625-0.311-0.95-0.432c-0.019-0.007-0.035-0.018-0.054-0.025 c-0.034-0.012-0.068-0.017-0.102-0.028c-0.31-0.107-0.625-0.197-0.944-0.263c-0.036-0.007-0.071-0.018-0.107-0.025 c-0.328-0.063-0.66-0.098-0.993-0.116c-0.079-0.004-0.158-0.008-0.238-0.01c-0.333-0.008-0.667,0-0.999,0.036 c-0.021,0.002-0.041,0.007-0.062,0.01c-0.322,0.038-0.641,0.101-0.958,0.181c-0.058,0.015-0.116,0.028-0.174,0.044 c-0.327,0.091-0.649,0.201-0.964,0.338c-0.036,0.016-0.07,0.034-0.105,0.05c-0.276,0.125-0.545,0.269-0.808,0.429 c-0.063,0.038-0.126,0.074-0.187,0.114c-0.254,0.165-0.503,0.342-0.741,0.541c-0.022,0.018-0.041,0.039-0.062,0.058 c-0.05,0.043-0.097,0.091-0.146,0.136c-0.226,0.205-0.437,0.42-0.633,0.645c-0.027,0.032-0.06,0.057-0.087,0.089l-225,268.318 c-1.392,1.66-1.998,3.841-1.663,5.981c0.335,2.14,1.58,4.03,3.413,5.185l225,141.682c0.056,0.035,0.116,0.059,0.173,0.092 c0.186,0.11,0.375,0.211,0.569,0.304c0.116,0.056,0.232,0.112,0.35,0.162c0.191,0.08,0.386,0.148,0.583,0.212 c0.123,0.04,0.244,0.084,0.368,0.117c0.213,0.057,0.429,0.098,0.646,0.137c0.108,0.019,0.214,0.046,0.323,0.061 c0.328,0.044,0.66,0.069,0.992,0.069c0.076,0,0.151-0.013,0.227-0.016c0.246-0.008,0.492-0.019,0.736-0.051 c0.143-0.019,0.283-0.054,0.425-0.081c0.182-0.035,0.365-0.066,0.545-0.115c0.144-0.038,0.284-0.091,0.426-0.138 c0.178-0.059,0.356-0.119,0.53-0.192c0.133-0.056,0.263-0.121,0.394-0.186c0.111-0.054,0.225-0.097,0.334-0.157 c0.067-0.037,0.126-0.084,0.192-0.123c0.059-0.035,0.122-0.06,0.181-0.096l225-141.682c1.833-1.154,3.078-3.045,3.413-5.185 C465.245,294.836,464.639,292.655,463.247,290.995z M240,423.91v-56.414c0-4.143-3.358-7.5-7.5-7.5s-7.5,3.357-7.5,7.5v56.414 L18.77,294.048L225,48.112v289.384c0,4.143,3.358,7.5,7.5,7.5s7.5-3.357,7.5-7.5V48.113l206.23,245.935L240,423.91z"/><path d="M383,301.057c4.411,0,8-3.589,8-8s-3.589-8-8-8s-8,3.589-8,8S378.589,301.057,383,301.057z"/><path d="M353,271.057c4.411,0,8-3.589,8-8s-3.589-8-8-8s-8,3.589-8,8S348.589,271.057,353,271.057z"/></g></svg>`,
    fact: {
	  en: "A pyramid has a flat base and sides shaped like triangles that meet at the top.",
	  nl: "Een piramide heeft een platte onderkant en zijkanten die driehoeken zijn en samenkomen in de punt."
    },
	mini: `<svg width="44" height="44" viewBox="0 0 465 465"><g><path style="fill:#FF9926;" d="M240,337.496c0,4.143-3.358,7.5-7.5,7.5v15c4.142,0,7.5,3.357,7.5,7.5v56.414l206.23-129.862 L240,48.113V337.496z M383,285.057c4.411,0,8,3.589,8,8s-3.589,8-8,8s-8-3.589-8-8S378.589,285.057,383,285.057z M353,255.057 c4.411,0,8,3.589,8,8s-3.589,8-8,8s-8-3.589-8-8S348.589,255.057,353,255.057z"/><path style="fill:#FECC33;" d="M225,337.496V48.112L18.77,294.048L225,423.91v-56.414c0-4.143,3.358-7.5,7.5-7.5v-15 C228.358,344.996,225,341.639,225,337.496z"/><path d="M463.247,290.995l-225-268.318c-0.073-0.088-0.154-0.165-0.231-0.249c-0.054-0.058-0.106-0.117-0.161-0.173 c-0.239-0.245-0.489-0.473-0.752-0.678c-0.024-0.018-0.049-0.034-0.073-0.052c-0.262-0.199-0.535-0.375-0.816-0.536 c-0.049-0.028-0.096-0.057-0.146-0.084c-0.308-0.167-0.625-0.311-0.95-0.432c-0.019-0.007-0.035-0.018-0.054-0.025 c-0.034-0.012-0.068-0.017-0.102-0.028c-0.31-0.107-0.625-0.197-0.944-0.263c-0.036-0.007-0.071-0.018-0.107-0.025 c-0.328-0.063-0.66-0.098-0.993-0.116c-0.079-0.004-0.158-0.008-0.238-0.01c-0.333-0.008-0.667,0-0.999,0.036 c-0.021,0.002-0.041,0.007-0.062,0.01c-0.322,0.038-0.641,0.101-0.958,0.181c-0.058,0.015-0.116,0.028-0.174,0.044 c-0.327,0.091-0.649,0.201-0.964,0.338c-0.036,0.016-0.07,0.034-0.105,0.05c-0.276,0.125-0.545,0.269-0.808,0.429 c-0.063,0.038-0.126,0.074-0.187,0.114c-0.254,0.165-0.503,0.342-0.741,0.541c-0.022,0.018-0.041,0.039-0.062,0.058 c-0.05,0.043-0.097,0.091-0.146,0.136c-0.226,0.205-0.437,0.42-0.633,0.645c-0.027,0.032-0.06,0.057-0.087,0.089l-225,268.318 c-1.392,1.66-1.998,3.841-1.663,5.981c0.335,2.14,1.58,4.03,3.413,5.185l225,141.682c0.056,0.035,0.116,0.059,0.173,0.092 c0.186,0.11,0.375,0.211,0.569,0.304c0.116,0.056,0.232,0.112,0.35,0.162c0.191,0.08,0.386,0.148,0.583,0.212 c0.123,0.04,0.244,0.084,0.368,0.117c0.213,0.057,0.429,0.098,0.646,0.137c0.108,0.019,0.214,0.046,0.323,0.061 c0.328,0.044,0.66,0.069,0.992,0.069c0.076,0,0.151-0.013,0.227-0.016c0.246-0.008,0.492-0.019,0.736-0.051 c0.143-0.019,0.283-0.054,0.425-0.081c0.182-0.035,0.365-0.066,0.545-0.115c0.144-0.038,0.284-0.091,0.426-0.138 c0.178-0.059,0.356-0.119,0.53-0.192c0.133-0.056,0.263-0.121,0.394-0.186c0.111-0.054,0.225-0.097,0.334-0.157 c0.067-0.037,0.126-0.084,0.192-0.123c0.059-0.035,0.122-0.06,0.181-0.096l225-141.682c1.833-1.154,3.078-3.045,3.413-5.185 C465.245,294.836,464.639,292.655,463.247,290.995z M240,423.91v-56.414c0-4.143-3.358-7.5-7.5-7.5s-7.5,3.357-7.5,7.5v56.414 L18.77,294.048L225,48.112v289.384c0,4.143,3.358,7.5,7.5,7.5s7.5-3.357,7.5-7.5V48.113l206.23,245.935L240,423.91z"/><path d="M383,301.057c4.411,0,8-3.589,8-8s-3.589-8-8-8s-8,3.589-8,8S378.589,301.057,383,301.057z"/><path d="M353,271.057c4.411,0,8-3.589,8-8s-3.589-8-8-8s-8,3.589-8,8S348.589,271.057,353,271.057z"/></g></svg>`

   },
   {
    id: "hexagonal_prism",
    name: {en: "Hexagonal Prism", nl: "Zeshoekig Prisma"},
    color: {en: "transparent", nl: "transparant"},
    svg: `<svg width="120" height="120" viewBox="0 0 100 100"><g id="SVGRepo_iconCarrier"><title></title><path d="M10.51782,78.08765l1.76093-.94818a1,1,0,0,0-.94818-1.761l-1.76093.94824a1,1,0,0,0,.94818,1.76093Z"></path><path d="M17.56158,74.29486l1.76093-.94818a1,1,0,0,0-.94818-1.761l-1.76093.94825a1,1,0,0,0,.94818,1.76092Z"></path><path d="M24.60535,70.50208l1.76092-.94825a1,1,0,1,0-.94818-1.76092l-1.76092.94818a1,1,0,0,0,.94818,1.761Z"></path><path d="M87.72113,77.13947l1.76093.94818a1,1,0,0,0,.94818-1.76093l-1.76093-.94824a1,1,0,0,0-.94818,1.761Z"></path><path d="M73.63361,69.55383l1.76092.94825a1,1,0,0,0,.94818-1.761l-1.76092-.94818a1,1,0,1,0-.94818,1.76092Z"></path><path d="M80.67737,73.34668l1.76092.94818a1,1,0,1,0,.94818-1.76092l-1.76092-.94825a1,1,0,0,0-.94818,1.761Z"></path><path d="M34,67h1a1,1,0,0,0,0-2H34a1,1,0,0,0,0,2Z"></path><path d="M41,67h1.99994a1,1,0,1,0,0-2H41a1,1,0,0,0,0,2Z"></path><path d="M48.99994,67h2a1,1,0,1,0,0-2h-2a1,1,0,0,0,0,2Z"></path><path d="M56.99994,67h2a1,1,0,1,0,0-2h-2a1,1,0,0,0,0,2Z"></path><path d="M65,67h1a1,1,0,0,0,0-2H65a1,1,0,0,0,0,2Z"></path><path d="M30,25a1,1,0,0,0-1,1v2a1,1,0,0,0,2,0V26A1,1,0,0,0,30,25Z"></path><path d="M30,9a1,1,0,0,0-1,1v2a1,1,0,0,0,2,0V10A1,1,0,0,0,30,9Z"></path><path d="M30,17a1,1,0,0,0-1,1v2a1,1,0,0,0,2,0V18A1,1,0,0,0,30,17Z"></path><path d="M70,9a1,1,0,0,0-1,1v2a1,1,0,0,0,2,0V10A1,1,0,0,0,70,9Z"></path><path d="M70,17a1,1,0,0,0-1,1v2a1,1,0,0,0,2,0V18A1,1,0,0,0,70,17Z"></path><path d="M70,25a1,1,0,0,0-1,1v2a1,1,0,0,0,2,0V26A1,1,0,0,0,70,25Z"></path><path d="M94.51971,19.1665C94.49866,19.14276,70.5,5.14,70.5,5.14A.99332.99332,0,0,0,70,5H30a.99332.99332,0,0,0-.5.14S5.519,19.1369,5.50671,19.14868A.98624.98624,0,0,0,5,20V80a.98742.98742,0,0,0,.5.86L29.42,94.81a.35261.35261,0,0,0,.08.05,1.22257,1.22257,0,0,0,.24.1A.82323.82323,0,0,0,30,95H70a.82323.82323,0,0,0,.26-.04,1.22257,1.22257,0,0,0,.24-.1.35261.35261,0,0,0,.08-.05L94.5,80.86A.98742.98742,0,0,0,95,80V20A.984.984,0,0,0,94.51971,19.1665ZM29,92.26,7,79.43V21.74L29,34.57ZM69,93H31V35H69Zm.73-60H30.27L7.98,20,30.27,7H69.73L92.02,20ZM93,79.43,71,92.26V34.57L93,21.74Z"></path></g></svg>`,
    fact: {
      en: "A hexagonal prism has hexagons at both ends.",
      nl: "Een zeshoekig prisma heeft een zeshoek aan beide uiteinden."
    },
    mini: `<svg width="44" height="44" viewBox="0 0 100 100"><g id="SVGRepo_iconCarrier"><title></title><path d="M10.51782,78.08765l1.76093-.94818a1,1,0,0,0-.94818-1.761l-1.76093.94824a1,1,0,0,0,.94818,1.76093Z"></path><path d="M17.56158,74.29486l1.76093-.94818a1,1,0,0,0-.94818-1.761l-1.76093.94825a1,1,0,0,0,.94818,1.76092Z"></path><path d="M24.60535,70.50208l1.76092-.94825a1,1,0,1,0-.94818-1.76092l-1.76092.94818a1,1,0,0,0,.94818,1.761Z"></path><path d="M87.72113,77.13947l1.76093.94818a1,1,0,0,0,.94818-1.76093l-1.76093-.94824a1,1,0,0,0-.94818,1.761Z"></path><path d="M73.63361,69.55383l1.76092.94825a1,1,0,0,0,.94818-1.761l-1.76092-.94818a1,1,0,1,0-.94818,1.76092Z"></path><path d="M80.67737,73.34668l1.76092.94818a1,1,0,1,0,.94818-1.76092l-1.76092-.94825a1,1,0,0,0-.94818,1.761Z"></path><path d="M34,67h1a1,1,0,0,0,0-2H34a1,1,0,0,0,0,2Z"></path><path d="M41,67h1.99994a1,1,0,1,0,0-2H41a1,1,0,0,0,0,2Z"></path><path d="M48.99994,67h2a1,1,0,1,0,0-2h-2a1,1,0,0,0,0,2Z"></path><path d="M56.99994,67h2a1,1,0,1,0,0-2h-2a1,1,0,0,0,0,2Z"></path><path d="M65,67h1a1,1,0,0,0,0-2H65a1,1,0,0,0,0,2Z"></path><path d="M30,25a1,1,0,0,0-1,1v2a1,1,0,0,0,2,0V26A1,1,0,0,0,30,25Z"></path><path d="M30,9a1,1,0,0,0-1,1v2a1,1,0,0,0,2,0V10A1,1,0,0,0,30,9Z"></path><path d="M30,17a1,1,0,0,0-1,1v2a1,1,0,0,0,2,0V18A1,1,0,0,0,30,17Z"></path><path d="M70,9a1,1,0,0,0-1,1v2a1,1,0,0,0,2,0V10A1,1,0,0,0,70,9Z"></path><path d="M70,17a1,1,0,0,0-1,1v2a1,1,0,0,0,2,0V18A1,1,0,0,0,70,17Z"></path><path d="M70,25a1,1,0,0,0-1,1v2a1,1,0,0,0,2,0V26A1,1,0,0,0,70,25Z"></path><path d="M94.51971,19.1665C94.49866,19.14276,70.5,5.14,70.5,5.14A.99332.99332,0,0,0,70,5H30a.99332.99332,0,0,0-.5.14S5.519,19.1369,5.50671,19.14868A.98624.98624,0,0,0,5,20V80a.98742.98742,0,0,0,.5.86L29.42,94.81a.35261.35261,0,0,0,.08.05,1.22257,1.22257,0,0,0,.24.1A.82323.82323,0,0,0,30,95H70a.82323.82323,0,0,0,.26-.04,1.22257,1.22257,0,0,0,.24-.1.35261.35261,0,0,0,.08-.05L94.5,80.86A.98742.98742,0,0,0,95,80V20A.984.984,0,0,0,94.51971,19.1665ZM29,92.26,7,79.43V21.74L29,34.57ZM69,93H31V35H69Zm.73-60H30.27L7.98,20,30.27,7H69.73L92.02,20ZM93,79.43,71,92.26V34.57L93,21.74Z"></path></g></svg>`
  }
]

];


const allShapesById = {};
shapeGroups.flat().forEach(shape => { allShapesById[shape.id] = shape; });



const quizQuestions = [
  {
    prompt: {en:"Which shape is round?", nl:"Welke vorm is rond?"},
    answerId: "circle"         // Refer to the shape's unique id
  },
  {
    prompt: {en:"Which one has three corners?", nl:"Welke heeft drie hoeken?"},
    answerId: "triangle"
  },
  {
    prompt: {en:"Which shape is green?", nl:"Welke vorm is groen?"},
    answerId: "square"
  },
  {
    prompt: {en:"Which shape has four sides?", nl:"Welke heeft vier zijden?"},
    answerId: "square"
  },
  {
    prompt: {en:"Which shape is yellow?", nl:"Welke vorm is geel?"},
    answerId: "star"
  },
  {
    prompt: {en:"Which shape has two long and two short sides?", nl:"Welke vorm heeft twee lange en twee korte zijden?"},
    answerId: "rectangle"
  },
  {
    prompt: {en:"Which one is shaped like an egg?", nl:"Welke lijkt op een ei?"},
    answerId: "oval"
  },
  // ...continue for all quiz questions, setting answerId for each one!
];


const stickers = ['üòä','üåà','ü•á','üçÄ','üöó','ü¶Ñ','üç¶','‚ú®','üéà','‚≠ê'];
const bgGradients = [
  "linear-gradient(to bottom, #aeefff 0%, #fffbe0 80%)",
  "linear-gradient(to top, #ffece3 0%, #e0fffb 90%)",
  "linear-gradient(110deg,#ffd1e3 30%,#d9fde5 90%)",
  "linear-gradient(160deg,#e9e6fd,#f9ffc5 90%)"
];
const sunColors = ["#ffe066","#ffd36b","#ffaf19","#ffdbe1"];
const niceWords = {
  en: ["Well done!","Awesome!","Great job!","Super!","Hooray!","That's right!","Nice click!"],
  nl: ["Goed gedaan!","Super!","Knap gedaan!","Goed zo!","Hoera!","Dat klopt!"]
};
const goodChoiceSpeech = {
  en: ["Good choice!", "Well done!", "That's right!"],
  nl: ["Goede keuze!", "Goed gedaan!", "Dat klopt!"]
};
const tryAgainSpeech = {
  en: ["Try again!", "Oops, not quite!", "Please try again!"],
  nl: ["Probeer het opnieuw!", "Oeps, niet helemaal!", "Probeer het nog eens!"]
};
const LANGUAGES = [
  {code:"en", label:"English"},
  {code:"nl", label:"Nederlands"}
];

let userInputBlocked = false;
let difficultyLevel=1, maxLevel=4, baseShapes=4;
let collectibles={};
let missions={ explorer: {status:'incomplete',steps:0,goal:6}};
let userStats={streak:0, mistakes:0, accuracy:100};

const realLifeExamples={
  //Circle: {video:"https://www.w3schools.com/html/mov_bbb.mp4", en:{audio:""}, nl:{audio:""}}
};

function setCustomBackground(imgUrl = null) {
  const grad = bgGradients[Math.min(unlockedShapeGroup, bgGradients.length - 1)];
  if (imgUrl) {
    document.body.style.background = `url('${imgUrl}') center/cover no-repeat, ${grad}`;
  } else {
    document.body.style.background = grad;
  }
}

function setUserInputBlocked(block) {
  userInputBlocked = block;
  shapeRow.style.pointerEvents = block ? "none" : "auto";
  // Optionally, disable other interactive UI if needed
  document.getElementById('reset-btn').disabled = block;
  document.querySelectorAll('.btnLang').forEach(btn => btn.disabled = block);
}


function adjustDifficulty(userStats){
  if(userStats.streak>=5){difficultyLevel=Math.min(difficultyLevel+1,maxLevel);userStats.streak=0;}
  else if(userStats.mistakes>=3){difficultyLevel=Math.max(difficultyLevel-1,1);userStats.mistakes=0;}
}

function getNextChallengeShapeIds() {
    const unlocked = getUnlockedShapes();
    let ids = unlocked.map(shape => shape.id);

    // Assign weights: default 1, favored gets higher weight
    const weights = {};
    ids.forEach(id => weights[id] = 1);
    weights["pyramid"] = 5;
	weights["hexagonal_prism"] = 4;
	weights["cube"] = 3;
	

    // Build weighted pool
    let weightedPool = [];
    ids.forEach(id => {
        for (let w = 0; w < weights[id]; w++) weightedPool.push(id);
    });

    // Shuffle
    for (let i = weightedPool.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [weightedPool[i], weightedPool[j]] = [weightedPool[j], weightedPool[i]];
    }

    // Pick the top N
    const maxChoices = Math.min(4 + difficultyLevel, weightedPool.length);
    // Remove duplicates so no shape appears twice per challenge
    const uniqueSelection = [...new Set(weightedPool)].slice(0, maxChoices);

    return uniqueSelection;
}


/*
function getNextChallengeShapeIds() {
  // Get unlocked shapes
  const unlocked = getUnlockedShapes();
  let ids = unlocked.map(shape => shape.id);
  // Shuffle
  for(let i=ids.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [ids[i],ids[j]]=[ids[j],ids[i]];
  }
  // minimum to show: 4, plus more as desired - you can tune below
  const maxChoices = Math.min(4 + difficultyLevel, ids.length);
  return ids.slice(0, maxChoices);
}
*/

function updateProgressBar(pct){
  document.getElementById('progress-bar').style.width = `${pct}%`;
}
function unlockCollectible(type, id) {
  if (!collectibles[type]) collectibles[type] = {};
  // If badge, count how many times earned
  if (type === 'badge') {
    collectibles[type][id] = (collectibles[type][id] || 0) + 1; // increment counter
  } else {
    collectibles[type][id] = true;
  }
  showTrophyCabinet(); saveGameState();
}
function showTrophyCabinet() {
  let html = "";
  Object.keys(collectibles).forEach(type =>
    Object.keys(collectibles[type]).forEach(id => {
      if (type === "badge") {
        let count = collectibles[type][id];
        html += `<span>${type}: ${id}&nbsp;üèÜ&nbsp;<strong>x${count}</strong></span>`;
      } else {
        html += `<span>${type}: ${id}&nbsp;üèÜ</span>`;
      }
    })
  );
  document.getElementById('trophy-cabinet').innerHTML = html || "(No trophies yet!)";
}

const missionBackgroundImages = [
  "https://upload.wikimedia.org/wikipedia/commons/7/7a/Pixel_Art_Background.jpg",                // Level 0 ‚Äî uses only gradient
  "Games_0.jpeg",
  "Games_1.jpeg",
  "Games_2.png",
  "Games_3.png",
  "Games_4.png",
  "Games_5.jpeg"
];


function startMission(id){
  if(!missions[id])missions[id]={status:'incomplete',steps:0,goal:5};
  let m=missions[id];
  document.getElementById('mission-block').textContent=
    m.status==='incomplete'?`Mission: Collect ${m.goal} shapes  (${m.steps}/${m.goal})`:"Mission Complete!";
	/*
	window.customBackgroundImage = null;
	setCustomBackground(null);
	*/

	let bgImg = missionBackgroundImages[
	  Math.min(unlockedShapeGroup, missionBackgroundImages.length - 1)
	];
	window.customBackgroundImage = bgImg;
	setCustomBackground(window.customBackgroundImage);
/*
	let themeIndex = Math.min(unlockedShapeGroup, backgroundThemes.length - 1);
	let currentTheme = backgroundThemes[themeIndex];
	renderAnimatedBackground(currentTheme);
	animateBackground(currentTheme);
	*/
	}


function completeMission(id, afterComplete) {
  // Mark mission complete and celebrate
  missions[id].status = "complete";
  unlockCollectible("badge", id);
  document.getElementById("mission-block").textContent = "Mission Complete!";
  const missionSpeech = (lang === "nl") ? "Missie voltooid!" : "Mission complete!";
  const lastGroupIndex = shapeGroups.length - 1;

  speakPhrase(missionSpeech, function () {
    showMilestonePopup("Mission Complete!", function () {

      // Helper: apply background from missionBackgroundImages + persist
      function applyBackgroundAndPersist() {
        const bgIndex = Math.min(unlockedShapeGroup, missionBackgroundImages.length - 1);
        window.customBackgroundImage = missionBackgroundImages[bgIndex];
        setCustomBackground(window.customBackgroundImage);
        saveGameState();
      }

      // 1) Unlock next group if available (with your announcement)
      // 2) If already at final group, count this mission as "after final unlock"
      if (unlockedShapeGroup < lastGroupIndex) {
        unlockedShapeGroup++;
        // If we just reached the final group, reset the counter
        if (unlockedShapeGroup === lastGroupIndex) {
          missionsAfterFinalUnlock = 0;
        }
        speakPhrase(
          (lang === "nl")
            ? "Je hebt een nieuwe groep vormen vrijgespeeld!"
            : "You've unlocked a new group of shapes!",
          function () {
            applyBackgroundAndPersist();
            proceed();
          }
        );
      } else {
        // Already at final group: this mission was played with ALL shapes available
        missionsAfterFinalUnlock += 1;
        applyBackgroundAndPersist();
        proceed();
      }

      function proceed() {
        const allComplete = Object.values(missions).every(m => m.status === "complete");
        const shapesUnlocked = (unlockedShapeGroup >= lastGroupIndex);

        // ‚úÖ Only show the end board when:
        //    - all shape groups are unlocked AND
        //    - all missions are complete AND
        //    - you've finished at least ONE mission AFTER the final unlock
        if (shapesUnlocked && allComplete && missionsAfterFinalUnlock >= 1) {
          showEndBoard();
          return;
        }

        // If missions are all complete but end condition isn't met yet, recycle one so play continues
        if (allComplete) {
          const ids = Object.keys(missions);
          const toReset = ids.length === 1 ? id : ids[0];
          missions[toReset].status = "incomplete";
          missions[toReset].steps = 0;
        }

        // Keep playing
        startNextIncompleteMission();
        if (typeof afterComplete === "function") afterComplete();
      }
    });
  });
}





// Helper to find and launch the next incomplete mission:
function startNextIncompleteMission() {
  // The order here determines play sequence!
  const orderedMissionIds = Object.keys(missions); // if you want to force an order, define it manually: ['shapes','colors','animals',...]
  for (let i = 0; i < orderedMissionIds.length; ++i) {
    const mid = orderedMissionIds[i];
    if (missions[mid].status !== "complete") {
      missions[mid].status = "incomplete";
      missions[mid].steps = 0;
      startMission(mid);
      updateProgressBar(0);
      return;
    }
  }
}




function updateMissionProgress(id){
  if(!missions[id]||missions[id].status==='complete')return;
  missions[id].steps++;
  let m = missions[id];
  // Force the bar to 100% on last step
  if(m.steps >= m.goal){
    updateProgressBar(100);            
    setTimeout(() => {                 
      completeMission(id);
    }, 800);                           // (adjust time as needed)
  } else {
    let pct = Math.round(100 * (m.steps / m.goal));
    updateProgressBar(pct);
    saveGameState(); startMission(id);
  }
}

function animateShapeDemo(shapeType){
  let el=Array.from(document.querySelectorAll('.shape')).find(e=>e.innerHTML.includes(shapeType));
  if(!el)return; el.animate([{transform:'rotate(0deg)'},{transform:'rotate(360deg)'}],{duration:1200});
}
function showFactWithAnimation(shapeType,fact){
  document.getElementById('fact-block').textContent=fact; animateShapeDemo(shapeType);
}

function getUnlockedShapes() {
  // Flatten all shape objects from 0..unlockedShapeGroup inclusive
  return shapeGroups.slice(0, unlockedShapeGroup + 1).flat();
}

function saveGameState(){
  const s = {
    correctCount,
    milestoneLevel,
    album,
    difficultyLevel,
    missions,
    collectibles,
    unlockedShapeGroup,
    missionsAfterFinalUnlock // NEW
  };
  localStorage.setItem('kidShapeGameState', JSON.stringify(s));
}


function loadGameState(){
  const state = localStorage.getItem('kidShapeGameState');
  if(state) {
    const g = JSON.parse(state);
    correctCount = g.correctCount || 0;
    milestoneLevel = g.milestoneLevel || 0;
    album = g.album || {};
    difficultyLevel = g.difficultyLevel || 1;
    missions = g.missions || missions;
    collectibles = g.collectibles || collectibles;
    unlockedShapeGroup = (typeof g.unlockedShapeGroup === "number" ? g.unlockedShapeGroup : 0);
    missionsAfterFinalUnlock = (typeof g.missionsAfterFinalUnlock === "number" ? g.missionsAfterFinalUnlock : 0); // NEW
  }
}



function showRealLifeExample(shapeName){
  let obj=realLifeExamples[shapeName];
  if(obj&&obj.video){
    document.getElementById('real-life-example').innerHTML = `<video controls autoplay width="160" src="${obj.video}"></video>`;
  } else document.getElementById('real-life-example').innerHTML="";
}
function advanceAfterFeedback(nextStepFunc, delayMs){
  setTimeout(nextStepFunc, delayMs||900);
}
// Popup with callback
function showMilestonePopup(msg, cb){
  cheer.currentTime=0;cheer.play(); confettiBurst();
  milestonePopup.textContent=msg; milestonePopup.style.display="block";
	setTimeout(()=>{
	  milestonePopup.style.display="none";
	  // Delay to let confetti start before proceeding
	  if(typeof cb === "function") {
		setTimeout(cb, 80); // 50‚Äì100ms is ideal
	  }
	},1800);
}

// --- UI and logic ---

let lang = "en";
let promptDiv = document.getElementById('prompt');
let feedback = document.getElementById('feedback');
let visualCue = document.getElementById('visual-cue');
let quizPrompt = document.getElementById('quizPrompt');
let shapeRow = document.getElementById('shape-row');
let factBlock = document.getElementById('fact-block');
let stickerBoard = document.getElementById('sticker-board');
let albumPics = document.getElementById('album-pics');
let milestonePopup = document.getElementById('milestone-popup');
let sunBg = document.getElementById('sun-bg');
let ding=document.getElementById('ding'), oops=document.getElementById('oops'), cheer=document.getElementById('cheer');
let correctCount=0, milestoneLevel=0, roundCount=0, quizMode=false, lastShapeIdx=-1, lastQuizIdx=-1, album={};

function renderLang() {
  let c = LANGUAGES.map(l=>`<button class="btnLang${lang===l.code?' selected':''}" onclick='setLang("${l.code}")'>${l.label}</button>`).join('');
  document.getElementById('langpicker').innerHTML="Language / Taal: " + c;
}
function setLang(l) { lang=l; renderLang(); newChallenge(); }

// START REMOVAL HERE
// =========================================================================
// HIGH-QUALITY SPEAKPHRASE IMPLEMENTATION (FINAL FIX: SAFETIES ADDED)
// This version waits for load and includes a timeout to ensure the game 
// always progresses even if playback events fail.
// =========================================================================

// Global reference to the hidden audio player element
const audioPlayer = document.getElementById('high-quality-audio-player'); 

/**
 * Fetches high-quality audio from an external TTS API (Google) 
 * and plays it, then executes a callback function (cb).
 * @param {string} text The phrase to speak.
 * @param {function} cb The function to call when the speech finishes (or fails).
 */
function speakPhrase(text, cb) {
    // 1. Determine the language code for the API
    const currentLang = lang || 'en';
    let ttsLangCode = (currentLang === 'nl') ? 'nl-NL' : 'en-US'; 
    
    // 2. Encode the text and build the API URL
    const encodedText = encodeURIComponent(text);
    const API_URL = `https://translate.google.com/translate_tts?ie=UTF-8&client=tw-ob&tl=${ttsLangCode}&q=${encodedText}`;

    let hasFinished = false;
    
    // Helper function to safely call the callback and reset listeners
    const finish = function() {
        if (hasFinished) return; // Prevent double execution
        hasFinished = true;

        if (typeof cb === 'function') {
            cb(); // <--- This is the CRITICAL unblock for the game logic!
        }
        // Cleanup
        audioPlayer.onloadeddata = null;
        audioPlayer.onended = null; 
        audioPlayer.onerror = null;
    };

    // 3. Set the fail-safe timeout (e.g., 5 seconds)
    // If we haven't finished after 5 seconds, assume failure and unblock the game.
    const failSafeTimer = setTimeout(function() {
        console.warn("TTS Playback timed out after 5 seconds. Unblocking game flow.");
        finish();
    }, 5000); 

    // 4. Clear existing handlers
    audioPlayer.onloadeddata = null;
    audioPlayer.onended = null; 
    audioPlayer.onerror = null;

    // 5. Set the end/error handlers to call the 'finish' function
    audioPlayer.onended = function() {
        clearTimeout(failSafeTimer);
        finish();
    }; 
    
    audioPlayer.onerror = function(e) {
        console.error("Error loading or playing TTS audio. Unblocking game flow.", e);
        clearTimeout(failSafeTimer);
        // On ANY error (loading or playing), ensure we unblock the game after a small delay
        setTimeout(finish, 500);
    };

    // 6. Set the event to fire once the data is loaded (to prevent cutoff)
    audioPlayer.onloadeddata = function() {
        // Now that the source is loaded, we can safely call play()
        audioPlayer.play().catch(e => {
            // This catches play() promise rejection (e.g., if interrupted)
            console.error("Failed to start audio playback after loading:", e);
            clearTimeout(failSafeTimer);
            // If play fails, unblock the game after a short delay
            setTimeout(finish, 500); 
        });
    };
    
    // 7. Set the source to begin fetching/loading the audio file
    audioPlayer.src = API_URL;

    // IMPORTANT: If the resource is already loaded (e.g., cached), onloadeddata might not fire.
    // Check state immediately after setting src to ensure play() is called.
    if (audioPlayer.readyState >= 2) { 
        audioPlayer.onloadeddata(); // Manually trigger the play logic
    }
}
// =========================================================================
// END REMOVAL HERE
function bounce(elem) {elem.style.transition='transform 0.24s cubic-bezier(.33,1.65,.49,.9)'; elem.style.transform='scale(1.13)'; setTimeout(()=>{ elem.style.transform='scale(1)'; setTimeout(()=>{elem.style.transition='';},120); },190);}
function confettiBurst() {
  for (let i=0; i<20; i++) {
    let star = document.createElement('div');
    star.textContent = ['üåà','‚ú®','üéä','‚≠ê','üéà','üç¶'][Math.floor(Math.random()*6)];
    star.style.position='fixed';star.style.left=(7+Math.random()*86)+'vw';
    star.style.top='-2vh';star.style.fontSize=(28+Math.random()*28)+'px';
    star.style.transition=`top 1.8s cubic-bezier(.29,1.1,.66,1.01)`;star.style.zIndex=999;star.style.pointerEvents='none';
    document.body.appendChild(star);
    setTimeout(()=>star.style.top=(55+Math.random()*18)+'vh',10);
    setTimeout(()=>star.remove(),1800);
  }
}
function rewardSticker(){ let sticker=document.createElement('span');sticker.textContent=stickers[(Math.floor(correctCount/5)-1)%stickers.length]; sticker.style.margin='0 2px'; stickerBoard.appendChild(sticker);}
function drawAlbum() {
  albumPics.innerHTML = Object.keys(album).map((sid) =>
    `<span class="album-pic">${allShapesById[sid].mini}<div class="album-label">${allShapesById[sid].name[lang]}</div></span>`
  ).join('') || '<span style="color:#b1c9ba;">(No shapes collected yet / Geen vormen gevonden)</span>';
}


document.getElementById('reset-btn').onclick = resetGameState;


function waitForExampleVideoOrAdvance(nextStepFunc, forceSkipVideo) {
  if (forceSkipVideo) {
    setTimeout(nextStepFunc, 750);
    return;
  }
  const video = document.querySelector('#real-life-example video');
  if (video) {
    video.addEventListener('ended', function handler() {
      video.removeEventListener('ended', handler);
      nextStepFunc();
    });
  } else {
    setTimeout(nextStepFunc, 500);
  }
}

// --- Challenge loop, quiz and startup ---
function newChallenge() {
  setUserInputBlocked(true);
  roundCount++;
  quizPrompt.textContent = '';
  shapeRow.innerHTML = '';
  visualCue.innerHTML = '';
  promptDiv.textContent = '';
  startMission("explorer");
  let m = missions['explorer'];
  let pct = m ? Math.min(100, Math.round(100 * (m.steps / m.goal))) : 0;
  updateProgressBar(pct);

  // Quiz every 7 rounds:
  if (roundCount % 7 === 0) {
    showQuiz();
    return;
  }

  quizMode = false;
  feedback.textContent = '';
  factBlock.textContent = '';
  document.getElementById('real-life-example').innerHTML = "";

  // Use unlocked shape pool, then pick a random one as answer
  let unlockedShapes = getUnlockedShapes();
  let availableIds = getNextChallengeShapeIds();
  let idx = Math.floor(Math.random() * availableIds.length);
  let answerShapeId = availableIds[idx];
  let answerShape = allShapesById[answerShapeId];

  visualCue.innerHTML = `<span class="label">${answerShape.name[lang]}</span>`;
  promptDiv.textContent = '';
  let promptText = (lang === "nl" ? "Klik op de " : "Click the ")
      + answerShape.color[lang] + " " + answerShape.name[lang];




	speakPhrase(promptText); // New
	setTimeout(() => setUserInputBlocked(false), 800);
/*	  
  speakPhrase(promptText, function() {
    setUserInputBlocked(false); 
  });
*/
  // Render clickable shapes
  shapeRow.innerHTML = '';
  availableIds.forEach((sid) => {
    let shape = allShapesById[sid];
    let d = document.createElement('span');
    d.className = "shape";
    d.tabIndex = 0;
    d.innerHTML = shape.svg + '<br>' + `<div class="label">${shape.name[lang]}</div>`;
    d.onclick = () => {
      if (userInputBlocked) return;
      setUserInputBlocked(true);

      if (sid === answerShapeId) {
        // Correct, as before -- but now based on shape IDs
        correctCount++;
        userStats.streak++;
        userStats.mistakes = 0;

        let missionStepsBefore = missions['explorer'].steps;
        let missionJustCompleted = false;
        missions['explorer'].steps++;
        missionJustCompleted = missions['explorer'].steps >= missions['explorer'].goal;
        let milestoneNow = (correctCount % 10 === 0 && correctCount > 0);

        feedback.textContent = niceWords[lang][Math.floor(Math.random() * niceWords[lang].length)];
        ding.currentTime = 0;
        ding.play();
        showFactWithAnimation(shape.name[lang], shape.fact[lang]);
        showRealLifeExample(shape.name.en);

        if (correctCount % 5 === 0) rewardSticker();
        if (!album[sid]) {
          album[sid] = {
            n: shape.name, en: shape.name.en, nl: shape.name.nl
          };
          drawAlbum();
        }
        adjustDifficulty(userStats);
        saveGameState();

        let m = missions['explorer'];
        let pct = m ? Math.min(100, Math.round(100 * (m.steps / m.goal))) : 0;
        updateProgressBar(pct);
        startMission("explorer");

        speakPhrase(shape.fact[lang], function () {
          if (missionJustCompleted) {
            completeMission("explorer", function () {
              setUserInputBlocked(false);
              waitForExampleVideoOrAdvance(newChallenge);
            });
          } else if (milestoneNow) {
            let milestoneSpeechDone = false;
            let milestonePopupDone = false;
            function proceedIfReady() {
              if (milestoneSpeechDone && milestonePopupDone) {
                setUserInputBlocked(false);
                waitForExampleVideoOrAdvance(newChallenge);
              }
            }
            speakPhrase(lang === "nl"
              ? "Je hebt een mijlpaal bereikt!"
              : "You've reached a milestone!", function () {
                milestoneSpeechDone = true;
                proceedIfReady();
              });
            showMilestonePopup("Milestone!", function () {
              milestonePopupDone = true;
              proceedIfReady();
            });
          } else {
            setUserInputBlocked(false);
            waitForExampleVideoOrAdvance(newChallenge);
          }
        });

      } else {
        userStats.mistakes++;
        userStats.streak = 0;
        feedback.textContent = (lang === "nl"
          ? "Probeer het opnieuw!"
          : "Try again!");
        speakPhrase((lang === "nl"
          ? "Probeer het opnieuw!"
          : "Try again!"), function () {
            setUserInputBlocked(false);
          });
        oops.currentTime = 0; oops.play();
        bounce(d);
        adjustDifficulty(userStats);
        saveGameState();
      }
    };
    d.onkeydown = function (e) { if (e.key === ' ' || e.key === 'Enter') d.click(); }
    shapeRow.appendChild(d);
  });
}




function showQuiz() {
	setUserInputBlocked(false); 
  let unlockedShapes = getUnlockedShapes();
  let unlockedShapeIds = unlockedShapes.map(s => s.id);
  let availableQuizQuestions = quizQuestions.filter(q =>
    unlockedShapeIds.includes(q.answerId)
  );
  if (availableQuizQuestions.length === 0) {
    newChallenge();
    return;
  }
  let qidx = Math.floor(Math.random() * availableQuizQuestions.length);
  let q = availableQuizQuestions[qidx];
  feedback.textContent = '';
  factBlock.textContent = '';
  quizPrompt.innerHTML = `<span class="quizstar">‚≠ê</span>Quiz: ${q.prompt[lang]}`;
  shapeRow.innerHTML = '';
  visualCue.innerHTML = '';
  speakPhrase(q.prompt[lang]);
  let shuffled = unlockedShapes.map(s => s.id).sort(() => Math.random() - 0.5);
  shuffled.forEach(sid => {
    let shape = allShapesById[sid];
    let d = document.createElement('span');
    d.className = "shape"; d.tabIndex = 0;
    d.innerHTML = shape.svg + '<br>' + `<div class="label">${shape.name[lang]}</div>`;
    d.onclick = () => {
      if (sid === q.answerId) {
        feedback.textContent = ((lang === "nl") ? "Geweldig!" : "Great job!") + " ‚≠ê";
        confettiBurst();
        ding.currentTime = 0; ding.play();
        let goodMsg = goodChoiceSpeech[lang][Math.floor(Math.random() * goodChoiceSpeech[lang].length)];
        let correctSpeech = goodMsg + " " + shape.name[lang] + "!";
        speakPhrase(correctSpeech, function () { waitForExampleVideoOrAdvance(newChallenge, true); });
      } else {
        let tryAgainMsg = tryAgainSpeech[lang][Math.floor(Math.random() * tryAgainSpeech[lang].length)];
        feedback.textContent = (lang === "nl" ? "Probeer nog een keer!" : "Nope, try again!");
        speakPhrase(tryAgainMsg);
        oops.currentTime = 0; oops.play(); bounce(d);
      }
    };
    d.onkeydown = function (e) { if (e.key === ' ' || e.key === 'Enter') d.click(); }
    shapeRow.appendChild(d);
  });
}

window.customBackgroundImage = null;
setCustomBackground(null);

function resetGameState() {
  window.customBackgroundImage = null;
  setCustomBackground(null);

  // Stop any ongoing audio
  if (ding) { ding.pause(); ding.currentTime = 0; }
  if (oops) { oops.pause(); oops.currentTime = 0; }
  if (cheer) { cheer.pause(); cheer.currentTime = 0; }
  // Cancel ongoing speech
  if ('speechSynthesis' in window) {
    window.speechSynthesis.cancel();
  }

  localStorage.removeItem('kidShapeGameState');
  correctCount = 0;
  milestoneLevel = 0;
  album = {};
  difficultyLevel = 1;
  missions = { explorer: {status:'incomplete',steps:0,goal:6} };
  collectibles = {};
  userStats = {streak:0, mistakes:0, accuracy:100};
  stickerBoard.innerHTML = "";
  unlockedShapeGroup = 0;
  missionsAfterFinalUnlock = 0; // NEW

  drawAlbum();
  showTrophyCabinet();
  startMission("explorer");
  updateProgressBar(0);
  window.customBackgroundImage = null;
  setCustomBackground(null);
  newChallenge();
}

function getTrophiesCount() {
  // Count everything in collectibles.
  // For badges we count their quantities; for other types we count distinct keys.
  let total = 0;
  if (collectibles && typeof collectibles === 'object') {
    Object.keys(collectibles).forEach(type => {
      const bag = collectibles[type] || {};
      Object.keys(bag).forEach(id => {
        if (type === 'badge') {
          total += (typeof bag[id] === 'number') ? bag[id] : 1;
        } else {
          total += 1;
        }
      });
    });
  }
  return total;
}

function getPrizesCount() {
  // Use the sticker board as your "prizes" tally.
  const el = document.getElementById('sticker-board');
  return el ? el.children.length : 0;
}


function showEndBoard() {
  // Stop any ongoing speech so it doesn't talk over the end board
  if ('speechSynthesis' in window) {
    window.speechSynthesis.cancel();
  }

  // Compute simple stats (these helpers can be the ones we added earlier)
  const trophies = (typeof getTrophiesCount === 'function') ? getTrophiesCount() : 0;
  const prizes   = (typeof getPrizesCount   === 'function') ? getPrizesCount()   : 0;

  // Create or reuse an overlay container
  let overlay = document.getElementById('end-board-overlay');
  if (!overlay) {
    overlay = document.createElement('div');
    overlay.id = 'end-board-overlay';
    overlay.style.position = 'fixed';
    overlay.style.inset = '0';
    overlay.style.background = 'rgba(0,0,0,0.7)';
    overlay.style.display = 'flex';
    overlay.style.alignItems = 'center';
    overlay.style.justifyContent = 'center';
    overlay.style.zIndex = '9999';
    document.body.appendChild(overlay);
  } else {
    overlay.style.display = 'flex';
    overlay.innerHTML = '';
  }

  // Card
  const card = document.createElement('div');
  card.style.background = 'white';
  card.style.borderRadius = '16px';
  card.style.padding = '24px';
  card.style.maxWidth = '520px';
  card.style.width = '90%';
  card.style.boxShadow = '0 10px 30px rgba(0,0,0,0.25)';
  card.style.textAlign = 'center';

  const title = document.createElement('h2');
  title.textContent = (lang === 'nl') ? 'Einde van het spel!' : 'End of the Game!';
  title.style.marginTop = '0';

  const msg = document.createElement('p');
  msg.textContent = (lang === 'nl')
    ? 'Fantastisch gedaan! Je hebt alle vormen vrijgespeeld en de laatste missie voltooid.'
    : 'Fantastic job! You‚Äôve unlocked all shapes and completed the final mission.';

  const stats = document.createElement('p');
  stats.style.opacity = '0.9';
  stats.style.margin = '12px 0 20px';
  stats.textContent = (lang === 'nl')
    ? `Trofee√´n: ${trophies} ¬∑ Stickers: ${prizes}`
    : `Trophies: ${trophies} ¬∑ Stickers: ${prizes}`;

  const btnRow = document.createElement('div');
  btnRow.style.display = 'flex';
  btnRow.style.gap = '12px';
  btnRow.style.justifyContent = 'center';
  btnRow.style.marginTop = '10px';

  // New Game ‚Äî resets EVERYTHING
  const newGameBtn = document.createElement('button');
  newGameBtn.id = 'end-new-game-btn';
  newGameBtn.textContent = (lang === 'nl') ? 'Nieuw spel' : 'New Game';
  newGameBtn.style.padding = '10px 16px';
  newGameBtn.style.borderRadius = '10px';
  newGameBtn.style.border = 'none';
  newGameBtn.style.cursor = 'pointer';
  newGameBtn.style.fontWeight = '600';
  newGameBtn.style.boxShadow = '0 2px 8px rgba(0,0,0,0.15)';

  // Close-only (optional)
  const closeBtn = document.createElement('button');
  closeBtn.textContent = (lang === 'nl') ? 'Sluiten' : 'Close';
  closeBtn.style.padding = '10px 16px';
  closeBtn.style.borderRadius = '10px';
  closeBtn.style.border = '1px solid #ddd';
  closeBtn.style.background = '#f7f7f7';
  closeBtn.style.cursor = 'pointer';

  // Wire up actions
  // Important: use { once: true } to avoid duplicate bindings if board is shown again
  newGameBtn.addEventListener('click', () => {
    overlay.style.display = 'none';
    // Full reset: clears localStorage, variables, audio, UI, and restarts mission flow
    resetGameState();
  }, { once: true });

  closeBtn.addEventListener('click', () => {
    overlay.style.display = 'none';
  }, { once: true });

  // Assemble
  btnRow.appendChild(newGameBtn);
  btnRow.appendChild(closeBtn);
  card.appendChild(title);
  card.appendChild(msg);
  card.appendChild(stats);
  card.appendChild(btnRow);
  overlay.appendChild(card);
}


function playAgain() {
  // Example: reload/restart game
  location.reload();
  // Or call your own startGame/reset function here instead!
}

// === TEST HARNESS HELPERS (insert above your final bootstrapping call) ===
function enableTestMode() {
  // Make everything instant and silent
  if (typeof speakPhrase === 'function') {
    window.__speakPhrase__orig = speakPhrase;
    speakPhrase = (t, cb) => { if (typeof cb === 'function') cb(); };
  }
  if (typeof showMilestonePopup === 'function') {
    window.__showMilestonePopup__orig = showMilestonePopup;
    showMilestonePopup = (msg, cb) => { try { cheer && (cheer.pause(), cheer.currentTime = 0); } catch(_){}; if (typeof cb === 'function') cb(); };
  }
  if (typeof waitForExampleVideoOrAdvance === 'function') {
    window.__waitForExampleVideoOrAdvance__orig = waitForExampleVideoOrAdvance;
    waitForExampleVideoOrAdvance = (next/*, force*/) => { if (typeof next === 'function') next(); };
  }
  try { [ding, oops, cheer].forEach(a => a && (a.muted = true)); } catch(_) {}

  // Remove the 800ms delay in updateMissionProgress
  window.__updateMissionProgress__orig = updateMissionProgress;
  updateMissionProgress = function(id){
    if(!missions[id] || missions[id].status === 'complete') return;
    missions[id].steps++;
    const m = missions[id];
    if (m.steps >= m.goal) {
      updateProgressBar(100);
      completeMission(id);
    } else {
      const pct = Math.round(100 * (m.steps / m.goal));
      updateProgressBar(pct);
      saveGameState();
      startMission(id);
    }
  };

  console.log('[TestMode] Enabled');
}

function autoPlayToEnd() {
  const lastGroupIndex = shapeGroups.length - 1;

  function completeOneMissionNow() {
    missions.explorer.status = 'incomplete';
    missions.explorer.steps = Math.max(0, missions.explorer.goal - 1);
    updateMissionProgress('explorer');
  }

  while (unlockedShapeGroup < lastGroupIndex) {
    completeOneMissionNow();
  }
  completeOneMissionNow(); // one more after final unlock
  console.log('[TestMode] Auto-play finished. End board should be visible.');
}

// Auto-enable test mode via URL:  ?test=autoplay  or  #autoplay
(function(){
  const p = new URLSearchParams(location.search);
  if (p.get('test') === 'autoplay' || location.hash.includes('autoplay')) {
    enableTestMode();
    // Give the app one tick to bootstrap, then fast-forward
    setTimeout(autoPlayToEnd, 30);
  }
})();


loadGameState(); drawAlbum(); renderLang(); showTrophyCabinet(); newChallenge();
</script>
</body>
</html>

//In console: enableTestMode(); autoPlayToEnd();
//Or open the page like: index_8.html?test=autoplay (or add #autoplay) ‚Üí it fast-forwards automatically.
