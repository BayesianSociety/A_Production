// prisma/schema.prisma

// --- Data source & generator ---
datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

// --- Models ---
model Language {
  code         String         @id // 'en', 'nl'
  name         String
  uiStrings    UIString[]
  animalI18n   AnimalI18n[]
  questionI18n QuestionI18n[]
  levelI18n    LevelI18n[]
}

model UIString {
  key      String
  langCode String
  value    String
  lang     Language @relation(fields: [langCode], references: [code])

  @@id([key, langCode])
  @@index([langCode])
}

model Continent {
  code      String            @id // 'AF','AN','AS','EU','NA','SA','OC'
  countries Country[]
  animals   AnimalContinent[]
}

model Country {
  iso2          String    @id // 'NL','US', ...
  name_en       String
  name_nl       String?
  continentCode String
  continent     Continent @relation(fields: [continentCode], references: [code])
}

model Animal {
  id          Int     @id @default(autoincrement())
  slug        String  @unique // e.g. 'lion'
  groupNumber Int
  region      String?
  isActive    Boolean @default(true)

  i18n      AnimalI18n[]
  mediaLink AnimalMedia[]
  habitats  AnimalContinent[]
  questions Question[]        @relation("AnswerAnimal")
}

model AnimalI18n {
  animalId    Int
  langCode    String
  name        String
  description String?
  fact        String?
  altText     String?

  animal Animal   @relation(fields: [animalId], references: [id])
  lang   Language @relation(fields: [langCode], references: [code])

  @@id([animalId, langCode])
  @@index([langCode])
}

model Media {
  id          Int           @id @default(autoincrement())
  url         String? // remote image URL (e.g., Wikipedia)
  localPath   String? // e.g., '/uploads/lion.jpg' (served by Express)
  role        String // 'photo' | 'mini' | 'audio' | 'bg'
  attribution String?
  license     String?
  animals     AnimalMedia[]
}

model AnimalMedia {
  animalId Int
  mediaId  Int
  role     String?
  primary  Boolean @default(false)

  animal Animal @relation(fields: [animalId], references: [id])
  media  Media  @relation(fields: [mediaId], references: [id])

  @@id([animalId, mediaId])
  @@index([mediaId])
}

model AnimalContinent {
  animalId      Int
  continentCode String

  animal    Animal    @relation(fields: [animalId], references: [id])
  continent Continent @relation(fields: [continentCode], references: [code])

  @@id([animalId, continentCode])
  @@index([continentCode])
}

model Question {
  id             Int     @id @default(autoincrement())
  difficulty     Int     @default(1)
  groupNumber    Int?
  isActive       Boolean @default(true)
  answerAnimalId Int?

  // Named relation to Animal
  answerAnimal Animal?        @relation("AnswerAnimal", fields: [answerAnimalId], references: [id])
  i18n         QuestionI18n[]
}

model QuestionI18n {
  questionId Int
  langCode   String
  prompt     String

  question Question @relation(fields: [questionId], references: [id])
  lang     Language @relation(fields: [langCode], references: [code])

  @@id([questionId, langCode])
  @@index([langCode])
}

model Level {
  id          Int         @id @default(autoincrement())
  groupNumber Int
  type        String // 'explorer' | 'quiz' etc.
  goal        Int
  active      Boolean     @default(true)
  i18n        LevelI18n[]
}

model LevelI18n {
  levelId     Int
  langCode    String
  title       String
  description String?

  level Level    @relation(fields: [levelId], references: [id])
  lang  Language @relation(fields: [langCode], references: [code])

  @@id([levelId, langCode])
}
